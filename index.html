<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ç‡ƒçƒ§ç‹ğŸ”¥ğŸ”¥ğŸ”¥ | åŒåˆçº¦ç‰ˆ</title>
<script src="https://cdn.bootcdn.net/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:sans-serif}
  body{background:#0a0a0a;color:#fff;padding:15px}
  .container{max-width:480px;margin:0 auto}
  .card{background:#121212;border-radius:20px;padding:24px;margin:16px 0;border:1px solid #222}
  .logo{font-size:24px;font-weight:700;color:#ff3d3d;text-align:center;margin:10px 0}
  #connectBtn{background:#ff3d3d;color:#fff;border:none;padding:12px;border-radius:12px;width:100%;font-weight:700;cursor:pointer}
  .balance{color:#aaa;margin-bottom:12px;display:flex;justify-content:space-between}
  input{width:100%;background:#1a1a1a;border:1px solid #333;border-radius:14px;padding:16px;color:#fff;margin-bottom:10px}
  .main-btn{width:100%;background:#ff3d3d;color:#fff;border:none;padding:16px;border-radius:14px;font-weight:700;cursor:pointer;margin-top:10px}
  .main-btn:disabled{background:#333}
  .status{margin-top:16px;padding:12px;border-radius:10px;text-align:center;display:none;font-size:13px}
  .status.info{background:#132a45;color:#90caf9;display:block}
  .status.success{background:#153a25;color:#81c784;display:block}
  .status.error{background:#3a1518;color:#e57373;display:block}
</style>
</head>
<body>
<div class="container">
  <div class="logo">ç‡ƒçƒ§ç‹ğŸ”¥ğŸ”¥ğŸ”¥</div>
  <button id="connectBtn" onclick="connectWallet()">è¿æ¥é’±åŒ…</button>

  <div class="card">
    <h3>ğŸ”¥ ç‡ƒçƒ§é”€æ¯</h3>
    <div class="balance"><span id="balanceTxt">ä½™é¢ï¼š--</span></div>
    <input type="number" id="burnAmount" placeholder="è¾“å…¥ç‡ƒçƒ§æ•°é‡">
    <button class="main-btn" onclick="approve()">1. æˆæƒ (Approve)</button>
    <button class="main-btn" onclick="burn()">2. ç¡®è®¤ç‡ƒçƒ§ (Burn)</button>
    <div id="status" class="status"></div>
  </div>

  <div class="card">
    <h3>ğŸ‘¥ é‚€è¯·ç»‘å®š</h3>
    <input type="text" id="inviter" placeholder="é‚€è¯·äººåœ°å€">
    <button class="main-btn" onclick="bindInviter()">ç¡®è®¤ç»‘å®šé‚€è¯·äºº</button>
  </div>

  <div class="card">
    <h3>ğŸ“Š æˆ‘çš„æ”¶ç›Š</h3>
    <p>æˆ‘çš„åˆ†çº¢ï¼š<strong id="myReward" style="color:#ff3d3d">-- BNB</strong></p>
    <button class="main-btn" onclick="claim()" style="background:#444">é¢†å–åˆ†çº¢</button>
  </div>
</div>

<script>
// ================= åŒåˆçº¦æ ¸å¿ƒé…ç½® =================
const CONFIG = {
  chainId: 56,
  tokenAddress: "0xe8803797e060a45cdf5b45249c3316da5bd87777", // ä»£å¸åœ°å€ï¼ˆæŸ¥ä½™é¢ï¼‰
  logicAddress: "0xe3115d9dad43e47e9ae54d3cef1001aa34d8e602"  // é€»è¾‘åœ°å€ï¼ˆåŠä¸šåŠ¡ï¼‰
};

const ABI = [
  "function decimals() view returns (uint8)",
  "function balanceOf(address) view returns (uint256)",
  "function approve(address, uint256) returns (bool)",
  "function burn(uint256)",
  "function bindInviter(address)",
  "function claimRewards()",
  "function pendingRewards(address) view returns (uint256)"
];

let signer, userAddress, tokenContract, logicContract;

function showStatus(text, type) {
  const s = document.getElementById('status');
  s.textContent = text;
  s.className = 'status ' + type;
}

async function connectWallet() {
  if (!window.ethereum) return alert('è¯·åœ¨é’±åŒ…å†…æ‰“å¼€');
  const provider = new ethers.providers.Web3Provider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = provider.getSigner();
  userAddress = await signer.getAddress();
  
  // åˆå§‹åŒ–ä¸¤ä¸ªåˆçº¦å¯¹è±¡
  tokenContract = new ethers.Contract(CONFIG.tokenAddress, ABI, signer);
  logicContract = new ethers.Contract(CONFIG.logicAddress, ABI, signer);
  
  document.getElementById('connectBtn').textContent = userAddress.slice(0,6)+'...';
  refresh();
}

async function refresh() {
  try {
    // ä»ã€ä»£å¸åˆçº¦ã€‘æŸ¥ä½™é¢ï¼Œè§£å†³ä½™é¢ä¸º0é—®é¢˜
    const bal = await tokenContract.balanceOf(userAddress);
    document.getElementById('balanceTxt').textContent = `ä½™é¢ï¼š${ethers.utils.formatUnits(bal, 18)}`;
    
    // ä»ã€é€»è¾‘åˆçº¦ã€‘æŸ¥åˆ†çº¢
    const pending = await logicContract.pendingRewards(userAddress).catch(()=>0);
    document.getElementById('myReward').textContent = ethers.utils.formatEther(pending) + ' BNB';
  } catch (e) { console.error(e); }
}

async function approve() {
  try {
    showStatus('æ­£åœ¨å‘é€»è¾‘åˆçº¦æˆæƒ...', 'info');
    // å…³é”®ï¼šæˆæƒç»™é€»è¾‘åˆçº¦åœ°å€
    const tx = await tokenContract.approve(CONFIG.logicAddress, ethers.constants.MaxUint256);
    await tx.wait();
    showStatus('æˆæƒæˆåŠŸï¼', 'success');
  } catch (e) { showStatus('æˆæƒå¤±è´¥', 'error'); }
}

async function burn() {
  const val = document.getElementById('burnAmount').value;
  try {
    showStatus('é€»è¾‘åˆçº¦æ‰§è¡Œç‡ƒçƒ§...', 'info');
    const tx = await logicContract.burn(ethers.utils.parseUnits(val.toString(), 18));
    await tx.wait();
    showStatus('ç‡ƒçƒ§æˆåŠŸ', 'success');
    refresh();
  } catch (e) { showStatus('ç‡ƒçƒ§å¤±è´¥ï¼Œè¯·æ£€æŸ¥ä½™é¢æˆ–æˆæƒ', 'error'); }
}

async function bindInviter() {
  const addr = document.getElementById('inviter').value;
  try {
    showStatus('é€»è¾‘åˆçº¦ç»‘å®šä¸­...', 'info');
    const tx = await logicContract.bindInviter(addr);
    await tx.wait();
    showStatus('ç»‘å®šæˆåŠŸï¼', 'success');
  } catch (e) { showStatus('ç»‘å®šå¤±è´¥', 'error'); }
}

async function claim() {
  try {
    const tx = await logicContract.claimRewards();
    await tx.wait();
    refresh();
  } catch (e) { alert('é¢†å–å¤±è´¥'); }
}
</script>
</body>
</html>