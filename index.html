<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ç‡ƒçƒ§ç‹ğŸ”¥ğŸ”¥ğŸ”¥ | BSCç‡ƒçƒ§åˆ†çº¢DApp</title>
<script src="https://cdn.bootcdn.net/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:"PingFang SC","Microsoft YaHei",sans-serif}
  body{background:#0a0a0a;color:#fff;padding:15px}
  .container{max-width:480px;margin:0 auto}
  header{display:flex;justify-content:space-between;align-items:center;padding:18px 0;border-bottom:1px solid #222}
  .logo{font-size:24px;font-weight:700;color:#ff3d3d}
  #connectBtn{background:#ff3d3d;color:#fff;border:none;padding:11px 18px;border-radius:12px;font-weight:700;cursor:pointer}
  #connectBtn:disabled{background:#333}
  .card{background:#121212;border-radius:20px;padding:24px;margin:16px 0;border:1px solid #222}
  .card h3{color:#ff3d3d;margin-bottom:18px;font-size:18px}
  .balance{color:#aaa;margin-bottom:12px}
  input{width:100%;background:#1a1a1a;border:1px solid #333;border-radius:14px;padding:16px;color:#fff;font-size:16px;outline:0;margin-bottom:10px}
  .quick{display:flex;gap:8px;margin-bottom:12px}
  .quick button{flex:1;background:#222;color:#fff;border:none;padding:12px;border-radius:10px;cursor:pointer}
  .btn-group{display:flex;gap:10px;margin-top:10px}
  .main-btn{flex:1;background:#ff3d3d;color:#fff;border:none;padding:16px;border-radius:14px;font-weight:700;cursor:pointer}
  .main-btn:disabled{background:#333}
  .warn{color:#ffbb00;font-size:12px;margin-top:10px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .grid-item{background:#1a1a1a;padding:16px;border-radius:12px}
  .grid-item strong{color:#ff3d3d;font-size:16px}
  .status{margin-top:16px;padding:12px;border-radius:10px;text-align:center}
  .status.info{background:#132a45;color:#90caf9}
  .status.success{background:#153a25;color:#81c784}
  .status.error{background:#3a1518;color:#e57373}
</style>
</head>
<body>
<div class="container">
<header>
  <div class="logo">ç‡ƒçƒ§ç‹ğŸ”¥ğŸ”¥ğŸ”¥</div>
  <button id="connectBtn">è¿æ¥é’±åŒ…</button>
</header>

<div class="card">
  <h3>ğŸ”¥ ç‡ƒçƒ§é”€æ¯ Â· å…¨ç½‘åˆ†çº¢</h3>
  <div class="balance" id="balanceTxt">ä½™é¢ï¼š0 ç‡ƒçƒ§ç‹ğŸ”¥ğŸ”¥ğŸ”¥</div>
  <input type="number" id="burnAmount" placeholder="è¾“å…¥ç‡ƒçƒ§æ•°é‡" min="0">
  <div class="quick">
    <button onclick="setQuick(10)">10%</button>
    <button onclick="setQuick(50)">50%</button>
    <button onclick="setQuick(100)">100%</button>
  </div>
  <div class="btn-group">
    <button class="main-btn" id="approveBtn" onclick="approve()">æˆæƒ</button>
    <button class="main-btn" id="burnBtn" onclick="burn()">ç¡®è®¤ç‡ƒçƒ§</button>
  </div>
  <div class="warn">âš ï¸ ç‡ƒçƒ§åæ°¸ä¹…é”€æ¯ï¼Œæ‰€æœ‰æ‰‹ç»­è´¹æŒ‰æ¯”ä¾‹åˆ†çº¢BNB</div>
  <div id="status" class="status"></div>
</div>

<div class="card">
  <h3>ğŸ“Š å…¨ç½‘æ•°æ®</h3>
  <div class="grid">
    <div class="grid-item">æ€»ç‡ƒçƒ§<br><strong id="totalBurn">0</strong></div>
    <div class="grid-item">ç‡ƒçƒ§äººæ•°<br><strong id="burnUsers">0</strong></div>
    <div class="grid-item">ä»Šæ—¥ç‡ƒçƒ§<br><strong id="todayBurn">0</strong></div>
    <div class="grid-item">æˆ‘çš„åˆ†çº¢<br><strong id="myReward">0 BNB</strong></div>
  </div>
  <button class="main-btn" id="claimBtn" onclick="claim()" style="width:100%;margin-top:16px">é¢†å–åˆ†çº¢</button>
</div>

</div>

<script>
// ====================== é…ç½® ======================
const CONFIG = {
  chainId: "0x38",                // BSCä¸»ç½‘ chainId
  tokenAddress: "0xè¿™é‡Œæ›¿æ¢æˆä½ çš„åˆçº¦åœ°å€",  // è¯·æ›¿æ¢ä¸ºå®é™…åˆçº¦åœ°å€
  symbol: "ç‡ƒçƒ§ç‹ğŸ”¥ğŸ”¥ğŸ”¥",
  decimals: 18
};
// ==================================================

// å®Œæ•´ä¸”æ­£ç¡®çš„ABIï¼ˆå·²ç§»é™¤bindInviterï¼Œå¦‚åˆçº¦éœ€è¦å¯è‡ªè¡Œæ·»åŠ ï¼‰
const ABI = [
  {"inputs":[],"stateMutability":"nonpayable","type":"constructor"},
  {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},
  {"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},
  {"stateMutability":"payable","type":"receive"},
  {"inputs":[],"name":"DECIMALS","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"DEAD_ADDRESS","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"TOTAL_SUPPLY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"burn","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[],"name":"burnerCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"claimRewards","outputs":[],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"totalBurned","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"todayBurn","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"user","type":"address"}],"name":"pendingRewards","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"userBurned","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},
  {"inputs":[{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},
  {"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}
];

let provider, signer, userAddress, contract;
let connectBtn = document.getElementById('connectBtn');
let statusBox = document.getElementById('status');

function showStatus(text, type) {
  statusBox.textContent = text;
  statusBox.className = 'status ' + type;
}

function fmt(num) {
  return parseFloat(ethers.utils.formatUnits(num, CONFIG.decimals)).toFixed(6);
}

async function connectWallet() {
  if (!window.ethereum) {
    showStatus('è¯·å®‰è£…MetaMask', 'error');
    return;
  }
  try {
    showStatus('è¿æ¥ä¸­...', 'info');
    connectBtn.disabled = true;
    await window.ethereum.request({ method: 'eth_requestAccounts' });
    provider = new ethers.providers.Web3Provider(window.ethereum);
    const network = await provider.getNetwork();
    if (network.chainId !== 56) {
      showStatus('è¯·åˆ‡æ¢åˆ°BSCä¸»ç½‘', 'error');
      connectBtn.disabled = false;
      return;
    }
    signer = provider.getSigner();
    userAddress = await signer.getAddress();
    contract = new ethers.Contract(CONFIG.tokenAddress, ABI, signer);
    connectBtn.textContent = userAddress.slice(0,6)+'...'+userAddress.slice(-4);
    showStatus('è¿æ¥æˆåŠŸ', 'success');
    refreshAll();
  } catch (err) {
    showStatus(err.message, 'error');
    connectBtn.disabled = false;
  }
}

async function refreshAll() {
  if (!contract) return;
  try {
    const bal = await contract.balanceOf(userAddress);
    document.getElementById('balanceTxt').textContent = `ä½™é¢ï¼š${fmt(bal)} ${CONFIG.symbol}`;
    document.getElementById('totalBurn').textContent = fmt(await contract.totalBurned());
    document.getElementById('todayBurn').textContent = fmt(await contract.todayBurn());
    document.getElementById('burnUsers').textContent = (await contract.burnerCount()).toString();
    const pending = await contract.pendingRewards(userAddress);
    document.getElementById('myReward').textContent = ethers.utils.formatEther(pending) + ' BNB';
  } catch (e) {}
}

function setQuick(p) {
  if (!contract || !userAddress) return;
  contract.balanceOf(userAddress).then(b => {
    // ä½¿ç”¨ BigNumber çš„ä¹˜é™¤æ³•ï¼Œé¿å… BigInt æ··ç”¨
    const val = b.mul(p).div(100);
    document.getElementById('burnAmount').value = ethers.utils.formatUnits(val, CONFIG.decimals);
  });
}

async function approve() {
  if (!contract) {
    showStatus('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
    return;
  }
  try {
    showStatus('æˆæƒä¸­...', 'info');
    const tx = await contract.approve(CONFIG.tokenAddress, ethers.constants.MaxUint256);
    await tx.wait();
    showStatus('æˆæƒæˆåŠŸ', 'success');
    refreshAll();
  } catch (e) {
    showStatus(e.message, 'error');
  }
}

async function burn() {
  if (!contract) {
    showStatus('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
    return;
  }
  const input = document.getElementById('burnAmount').value;
  if (!input || input <= 0) {
    showStatus('è¯·è¾“å…¥æ­£ç¡®ç‡ƒçƒ§æ•°é‡', 'error');
    return;
  }
  try {
    showStatus('ç‡ƒçƒ§ä¸­...', 'info');
    const amount = ethers.utils.parseUnits(input, CONFIG.decimals);
    const tx = await contract.burn(amount);
    await tx.wait();
    showStatus('ç‡ƒçƒ§æˆåŠŸï¼åˆ†çº¢å·²ç´¯è®¡', 'success');
    refreshAll();
  } catch (e) {
    showStatus(e.message, 'error');
  }
}

async function claim() {
  if (!contract) {
    showStatus('è¯·å…ˆè¿æ¥é’±åŒ…', 'error');
    return;
  }
  try {
    showStatus('é¢†å–åˆ†çº¢ä¸­...', 'info');
    const tx = await contract.claimRewards();
    await tx.wait();
    showStatus('åˆ†çº¢é¢†å–æˆåŠŸ', 'success');
    refreshAll();
  } catch (e) {
    showStatus(e.message, 'error');
  }
}

connectBtn.addEventListener('click', connectWallet);
</script>
</body>
</html>

